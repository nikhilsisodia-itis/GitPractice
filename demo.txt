New code added replacing all the previous code.

Added new code from demo1 branch.